"use strict";angular.module("fotbollskalendernWebApp",["ngRoute","ui.bootstrap","LocalStorageModule"]).value().config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/calendar",{templateUrl:"views/calendar.html",controller:"CalendarCtrl"}).when("/match",{templateUrl:"views/match.html",controller:"MatchCtrl"}).when("/team",{templateUrl:"views/team.html",controller:"TeamCtrl"}).when("/about",{templateUrl:"views/about.html"}).when("/league",{templateUrl:"views/league.html",controller:"LeagueCtrl"}).otherwise({redirectTo:"/"})}]).filter("futureDates",function(){return function(a){for(var b=[],c=(new Date).getTime(),d=0;d<a.length;d++){var e=new Date(a[d].date).getTime();e>c&&b.push(a[d])}return b}}).filter("filterArray",function(){return function(a,b){for(var c=[],d=0;d<a.length;d++)-1!==b.indexOf(a[d].league)&&c.push(a[d]);return c}}).filter("orderObjectBy",function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){d.push(a)}),d.sort(function(a,c){return a[b]>c[b]?1:-1}),c&&d.reverse(),d}}).filter("toSwedishWeekday",function(){return function(a){switch(a){case"Monday":return"Måndag";case"Thuesday":return"Tisdag";case"Wednesday":return"Onsdag";case"Thursday":return"Torsdag";case"Friday":return"Fredag";case"Saturday":return"Lördag";case"Sunday":return"Söndag"}}}),angular.module("fotbollskalendernWebApp").constant("Leagues",[{name:"Premier league",url:"http://api.football-data.org/v1/soccerseasons/398/"},{name:"La liga",url:"http://api.football-data.org/v1/soccerseasons/399/"},{name:"Bundesliga",url:"http://api.football-data.org/v1/soccerseasons/394/"},{name:"Serie A",url:"http://api.football-data.org/v1/soccerseasons/401/"},{name:"Franskaligan",url:"http://api.football-data.org/v1/soccerseasons/396/"}]),angular.module("fotbollskalendernWebApp").controller("MainCtrl",["$scope","$location","MatchService",function(a,b,c){var d=function(b){c.getGamesByDate(b).then(function(c){a.allDays.push({date:b,games:c})})};a.allDays=[];var e=7,f=new Date;a.gameIsPassed=f.getHours()+2,a.now=f.getHours();for(var g={year:"numeric",month:"2-digit",day:"2-digit"},h=0;e>h;h++)d(f.toLocaleDateString("sv-SE",g)),f.setDate(f.getDate()+1);a.matchInfo=function(a){b.path("match").search("url",a._links.self.href)}}]),angular.module("fotbollskalendernWebApp").controller("CalendarCtrl",["$scope","MatchService","$location",function(a,b,c){var d=function(c){b.getGamesByDate(c).then(function(b){a.allDays.push({date:c,games:b})})};a.allDays=[];for(var e=30,f=new Date,g={year:"numeric",month:"2-digit",day:"2-digit"},h=0;e>h;h++)d(f.toLocaleDateString("sv-SE",g)),f.setDate(f.getDate()+1);a.matchInfo=function(a){c.path("match").search("url",a._links.self.href)}}]),angular.module("fotbollskalendernWebApp").controller("MatchCtrl",["$scope","$location","DataService",function(a,b,c){a.match={};var d=b.search().url;c.getDataFromUrl(d).then(function(b){a.match=b}),a.teamInfo=function(a,c){c?b.path("team").search("url",a._links.homeTeam.href):b.path("team").search("url",a._links.awayTeam.href)}}]),angular.module("fotbollskalendernWebApp").controller("TeamCtrl",["$scope","$location","DataService","FavouritesService",function(a,b,c,d){var e=b.search().url;a.url=e,a.games={},a.isFavourite=!1;var f={};c.getDataFromUrl(e).then(function(b){f=b,c.getDataFromUrl(f._links.fixtures.href).then(function(b){a.games=b.fixtures,a.teamInformation=f,a.isFavourite=d.isFavourite(f.name)})}),a.addToFavourites=function(b,c){a.isFavourite=!a.isFavourite,d.toggleFavourite(b,c)},a.matchInfo=function(a){b.path("match").search("url",a._links.self.href)}}]),angular.module("fotbollskalendernWebApp").controller("LeagueCtrl",["$scope","$location","DataService",function(a,b,c){a.table={};var d=b.search().url;c.getDataFromUrl(d+"leagueTable").then(function(b){a.table=b}),a.viewTeam=function(a){b.path("team").search("url",a._links.team.href)}}]),angular.module("fotbollskalendernWebApp").directive("gamesList",function(){return{templateUrl:"scripts/directives/games-list.html",restrict:"E",scope:{games:"=",action:"=",includeDate:"=",day:"=",allDays:"="}}}),angular.module("fotbollskalendernWebApp").directive("shortcuts",["$location","Leagues","localStorageService","FavouritesService",function(a,b,c,d){return{restrict:"A",link:function(e){null===c.get("favourites")&&c.set("favourites",[{name:"FC Barcelona",url:"http://api.football-data.org/v1/teams/81"}]),e.leagues=b,e.favourites=d.favourites,console.log(e.favourites),e.viewMatch=function(b){a.path("team").search("url",b)},e.viewLeague=function(c){var d=b.filter(function(a){return a.name===c})[0];a.path("league").search("url",d.url)}}}}]),angular.module("fotbollskalendernWebApp").directive("leagueFilter",["FilterService",function(a){return{templateUrl:"views/league-filter.html",restrict:"E",link:function(b){null===a.getLeagueFilters()&&a.setLeagueFilters([]),b.filters=a.getLeagueFilters(),b.filterMatch=function(c){-1===a.getLeagueFilters().indexOf(c)?(a.addLeague(c),b.filters.push(c)):(a.removeLeague(c),b.filters.splice(b.filters.indexOf(c),1))}}}}]),angular.module("fotbollskalendernWebApp").factory("MatchService",["$http","$q","Leagues",function(a,b,c){var d="2ecca4360cd746d5a4808ba2b8e1fa96",e=[];c.forEach(function(b){e.push(a.get(b.url+"fixtures",{headers:{"X-Auth-Token":d}}))});var f=b.all(e);return{getGamesByDate:function(a){var d=[],e=b.defer();return f.then(function(b){b.forEach(function(b,e){var f=b.data.fixtures,g=e;f.forEach(function(b){0===b.date.indexOf(a)&&d.push({game:b,league:c[g].name})})}),e.resolve(d)}),e.promise},getGameByUrl:function(c){var e=b.defer();return a.get(c,{headers:{"X-Auth-Token":d}}).then(function(a){e.resolve(a.data)}),e.promise}}}]),angular.module("fotbollskalendernWebApp").factory("FavouritesService",["localStorageService",function(a){var b=a.get("favourites"),c=-1;return{isFavourite:function(a){for(var d=0;d<b.length;d++)if(b[d].name===a)return c=d,!0;return!1},toggleFavourite:function(d,e){this.isFavourite(d)?b.splice(c,1):b.push({name:d,url:e}),a.set("favourites",b)},favourites:b}}]),angular.module("fotbollskalendernWebApp").factory("FilterService",["localStorageService",function(a){return{setLeagueFilters:function(b){a.set("savedFilter",b)},getLeagueFilters:function(){return a.get("savedFilter")},addLeague:function(b){var c=a.get("savedFilter");c.push(b),this.setLeagueFilters(c)},removeLeague:function(b){var c=a.get("savedFilter");c.splice(c.indexOf(b),1),this.setLeagueFilters(c)}}}]),angular.module("fotbollskalendernWebApp").factory("DataService",["$http","$q",function(a,b){var c="2ecca4360cd746d5a4808ba2b8e1fa96";return{getDataFromUrl:function(d){var e=b.defer();return a.get(d,{headers:{"X-Auth-Token":c}}).then(function(a){e.resolve(a.data)}),e.promise}}}]),angular.module("fotbollskalendernWebApp").factory("TeamService",["$http","$q",function(a,b){var c="2ecca4360cd746d5a4808ba2b8e1fa96";return{getTeamInformation:function(d){var e=b.defer();return a.get(d,{headers:{"X-Auth-Token":c}}).then(function(a){e.resolve(a.data)}),e.promise},getGamesFromUrl:function(d){var e=b.defer();return a.get(d,{headers:{"X-Auth-Token":c}}).then(function(a){e.resolve(a.data)}),e.promise}}}]);